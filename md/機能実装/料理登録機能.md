# 料理登録機能の実装
## DBにdishesテーブルを作成

### マイグレーション・モデル作成

以下のコマンドでマイグレーションとモデルを作成
```bash
sail artisan make:model Dishes -m

# 以下はコントローラーも一緒に作成
sail artisan make:model Post -mc

# 以下はコントローラーをリソースコントローラーとして作成
sail artisan make:model Post -mcr
```
<br>

### マイグレーションを編集
```php
// 省略
public function up(): void
{
    Schema::create('dishes', function (Blueprint $table) {
        $table->id();
        //以下の２つを追記
        $table->string('name');
        $table->foreignId('user_id')
            ->constrained()->onDelete('cascade');
        $table->timestamps();
    });
}
// 省略
```
**upメソッド**に作成したいカラムを`$table->型('カラム名')->オプション`形式で書く。

`id`と`timestamps`カラムはデフォルトで設定されているので、料理名用の`name`カラムと、usersテーブルとのリレーション用の`user_id`カラムを追記。

`->constrained()->onDelete('cascade');`<br>紐づけられたuser_idのカラムが削除されたときの挙動を書いており、この場合は一緒に削除される。

`->references('id')->on('users')->onDelete('cascade');`<br>このように書くこともできる。

### DBにマイグレーション
以下のコマンドでマイグレーションを実行
```bash
sail artisan migrate
```
これによりDBにdishesテーブルを作成完了

<br>

## Dishesモデルの処理

先ほどのコマンドで作成したDishesモデルを編集
```php
// 省略
class Dishes extends Model
{
    // 以下を追記
    use HasFactory;
        protected $fillable = [
            'name',
            'user_id',
        ];
        public function user()
        {
            return $this->belongsTo(User::class);
        }
}
```
`use HasFactory;`<br>テスト用のダミーデータ作成機能のための宣言

`protected $fillable`<br>
ここに宣言したカラムはコントローラー等からデータ編集可能（ホワイトリスト）

`public function user(){`<br>
`return $this->belongsTo(User::class);`<br>
`}`<br>
リレーション処理、このメソッド名からリレーションモデルを参照できる。<br>
*belongsTo()* でこの場合dishes->usersが多対一という意味になる。

リレーションは相互に行う必要があり`Userモデル`側では以下のような処理を追記しておく。
```php
// 省略
public function dishes()
    {
        return $this->hasMany(Dishes::class);
    }
```
*hasMany()* でこの場合users->dishesが一対多という意味になる。

<br>

ここまででDBを操作する準備が整ったので、ここからは機能の処理を書いていく。

---

## Viewの作成